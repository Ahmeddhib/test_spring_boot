sudo apt install -y apt-transport-https curl
curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -
echo "deb https://apt.kubernetes.io/ kubernetes-xenial main" | sudo tee /etc/apt/sources.list.d/kubernetes.list
sudo apt update
sudo apt install -y kubelet kubeadm kubectl
sudo apt-mark hold kubelet kubeadm kubectl


Étape 1.3 : Initialiser le Cluster Kubernetes
bash
# Désactiver le swap
sudo swapoff -a
sudo sed -i '/ swap / s/^\(.*\)$/#\1/g' /etc/fstab

# Initialiser le cluster
sudo kubeadm init --pod-network-cidr=192.168.0.0/16

# Configurer kubectl pour l'utilisateur courant
mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config

# Installer un réseau pod (Canal)
kubectl apply -f https://docs.projectcalico.org/manifests/canal.yaml


2. Création et Gestion des Pods
Étape 2.1 : Créer un Pod avec un fichier YAML
bash
# Créer le fichier nodepod.yaml
cat > nodepod.yaml << EOF
apiVersion: v1
kind: Pod
metadata:
  name: first-pod
  labels:
    app: non-application
    environment: development
spec:
  containers:
  - name: conteneur-api
    image: hashicorp/http-echo
    args:
    - "-text=Hello Kubernetes ~~"
    ports:
    - containerPort: 5678
EOF

# Appliquer le fichier
kubectl apply -f nodepod.yaml

# Vérifier le pod
kubectl get pods
kubectl describe pod first-pod
Étape 2.2 : Tester avec kubectl run (déprécié mais utile pour les tests)
bash
# Créer un pod temporaire
kubectl run test --image=nginx --port=80

# Voir tous les pods
kubectl get pods

# Supprimer un pod
kubectl delete pod test
3. Gestion des Namespaces
Étape 3.1 : Lister et créer des namespaces
bash
# Lister les namespaces existants
kubectl get namespaces

# Créer un nouveau namespace
kubectl create namespace aimed

# Vérifier la création
kubectl get namespaces

# Utiliser un namespace spécifique
kubectl get pods --namespace=aimed
4. Création de Services
Étape 4.1 : Créer un Service NodePort
bash
# Créer le fichier service.yaml
cat > service.yaml << EOF
apiVersion: v1
kind: Service
metadata:
  name: first-service
spec:
  selector:
    app: non-application   # doit correspondre au Label du Pod
  ports:
  - protocol: TCP
    port: 5678    # port interne du service
    targetPort: 5678    # port exposé par le Pod
    nodePort: 30880    # port externe fixe (entre 30000-32767)
  type: NodePort
EOF

# Appliquer le service
kubectl apply -f service.yaml

# Vérifier le service
kubectl get svc
kubectl describe svc first-service
Étape 4.2 : Tester le service
bash
# Tester depuis la machine hôte
curl http://localhost:30880

# Si depuis l'extérieur, trouver l'IP de la VM
ip addr show

# Tester avec l'IP de la VM
curl http://<IP-VM>:30880
5. Gestion des ReplicaSets
Étape 5.1 : Créer un ReplicaSet
bash
# Créer le fichier replicas.yaml
cat > replicas.yaml << EOF
apiVersion: apps/v1
kind: ReplicaSet
metadata:
  name: myapp-rs
spec:
  replicas: 3
  selector:
    matchLabels:
      app: myapp
  template:
    metadata:
      labels:
        app: myapp
    spec:
      containers:
      - name: myapp-container
        image: nginx:latest
        ports:
        - containerPort: 80
EOF

# Appliquer le ReplicaSet
kubectl apply -f replicas.yaml

# Vérifier les pods créés
kubectl get pods

# Vérifier le ReplicaSet
kubectl get replicasets
kubectl describe replicaset myapp-rs
Étape 5.2 : Tester la résilience du ReplicaSet
bash
# Supprimer un pod du ReplicaSet
kubectl delete pod myapp-rs-m2kfm

# Observer la recréation automatique
kubectl get pods --watch

# Vérifier que le nombre de pods reste à 3
kubectl get pods | grep myapp-rs | wc -l
6. Commandes de Vérification et Dépannage
Étape 6.1 : Commandes essentielles
bash
# Vérifier l'état du cluster
kubectl cluster-info
kubectl get nodes
kubectl get all --all-namespaces

# Vérifier les logs d'un pod
kubectl logs first-pod
kubectl logs -f first-pod  # suivre les logs en temps réel

# Exécuter des commandes dans un pod
kubectl exec -it first-pod -- /bin/sh

# Vérifier les événements
kubectl get events
kubectl get events --sort-by='.lastTimestamp'

# Vérifier les ressources système
kubectl top pods
kubectl top nodes
7. Nettoyage
Étape 7.1 : Supprimer les ressources créées
bash
# Supprimer des ressources spécifiques
kubectl delete -f replicas.yaml
kubectl delete -f service.yaml
kubectl delete -f nodepod.yaml

# Supprimer toutes les ressources dans un namespace
kubectl delete all --all -n default

# Supprimer un namespace
kubectl delete namespace aimed

# Réinitialiser le cluster (si nécessaire)
sudo kubeadm reset
8. Points Importants à Noter
Ports NodePort : Doivent être entre 30000 et 32767

Labels : Les sélecteurs de service doivent correspondre exactement aux labels des pods

ReplicaSets : Maintenir un nombre défini de pods, recrée automatiquement les pods défaillants

Namespaces : Permettent d'isoler les ressources (développement, production, etc.)

Services : Fournissent une IP stable et un DNS pour accéder aux pods

9. Extensions Recommandées
Pour aller plus loin :

bash
# Installer le dashboard Kubernetes
kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommended.yaml

# Créer un utilisateur admin pour le dashboard
kubectl create serviceaccount dashboard-admin-sa
kubectl create clusterrolebinding dashboard-admin-sa \
  --clusterrole=cluster-admin \
  --serviceaccount=default:dashboard-admin-sa

# Obtenir le token
kubectl describe secret $(kubectl get secret | grep dashboard-admin-sa | awk '{print $1}')
Ce guide couvre toutes les étapes démontrées dans vos captures d'écran. Chaque commande est expliquée et peut être exécutée séquentiellement pour reproduire l'intégralité de la démonstration.


********************************************************************************
# 1. Mettre à jour les paquets
sudo apt update
sudo apt upgrade -y

# 2. Installer les dépendances nécessaires
sudo apt install -y apt-transport-https ca-certificates curl

# 3. Télécharger et ajouter la clé GPG de Kubernetes
curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.30/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg

# 4. Ajouter le dépôt Kubernetes
echo 'deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.30/deb/ /' | sudo tee /etc/apt/sources.list.d/kubernetes.list

# 5. Mettre à jour les dépôts APT
sudo apt update

# 6. Installer Kubernetes
sudo apt install -y kubelet kubeadm kubectl

# 7. Empêcher les mises à jour automatiques
sudo apt-mark hold kubelet kubeadm kubectl

# 8. Vérifier l'installation
kubeadm version
kubectl version --client


**************************************************************************************************************
# 1. Vérifier Docker
sudo systemctl start docker
sudo systemctl enable docker

# 2. Désactiver swap
sudo swapoff -a

# 3. Réinitialiser si nécessaire
sudo kubeadm reset -f
sudo rm -rf /etc/kubernetes/ $HOME/.kube

# 4. Initialiser le cluster
sudo kubeadm init --pod-network-cidr=192.168.0.0/16

# 5. Configurer kubectl
mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config

# 6. Installer le réseau pod
kubectl apply -f https://github.com/flannel-io/flannel/releases/latest/download/kube-flannel.yml

# 7. Autoriser les pods sur le nœud master
kubectl taint nodes --all node-role.kubernetes.io/control-plane-

# 8. Vérifier
kubectl get nodes
kubectl get pods --all-namespaces

